---
title: "Sampling analysis"
output: word_document
---

```{r setup, include=FALSE}
#Prevents warning messages from writing to the knitted document
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
```

```{r}
## Summarizes data.
## Gives count, mean, standard deviation, standard error of the mean, and confidence interval (default 95%).
##   data: a data frame.
##   measurevar: the name of a column that contains the variable to be summariezed
##   groupvars: a vector containing names of columns that contain grouping variables
##   na.rm: a boolean that indicates whether to ignore NA's
##   conf.interval: the percent range of the confidence interval (default is 95%)
summarySE <- function(data=NULL, measurevar, groupvars=NULL, na.rm=FALSE,
                      conf.interval=.95, .drop=TRUE) {
  library(plyr)
  
  # New version of length which can handle NA's: if na.rm==T, don't count them
  length2 <- function (x, na.rm=FALSE) {
    if (na.rm) sum(!is.na(x))
    else       length(x)
  }
  
  # This does the summary. For each group's data frame, return a vector with
  # N, mean, and sd
  datac <- ddply(data, groupvars, .drop=.drop,
                 .fun = function(xx, col) {
                   c(N    = length2(xx[[col]], na.rm=na.rm),
                     mean = mean   (xx[[col]], na.rm=na.rm),
                     sd   = sd     (xx[[col]], na.rm=na.rm)
                   )
                 },
                 measurevar
  )
  
  # Rename the "mean" column    
  datac <- rename(datac, c("mean" = measurevar))
  
  datac$se <- datac$sd / sqrt(datac$N)  # Calculate standard error of the mean
  
  # Confidence interval multiplier for standard error
  # Calculate t-statistic for confidence interval: 
  # e.g., if conf.interval is .95, use .975 (above/below), and use df=N-1
  ciMult <- qt(conf.interval/2 + .5, datac$N-1)
  datac$ci <- datac$se * ciMult
  
  return(datac)
}
```

```{r}
library(ggplot2)
library(ggpmisc)
library(DHARMa)
library(glmmTMB)
library(fitdistrplus)
library(MuMIn)
library(sp)
library(ggmap)
library(mapview)
library(RColorBrewer)
library(rgdal)
library(geojsonio)
library(geojsonsf)
library(sf)
library(maptools)
library(dplyr)
library(readr)
library(leafem)
library(spData)
library(lme4)
library(car)
library(lme4)
```
#Set up
```{r}
#Code contained herein was written by Cody Prouty, https://scholar.google.com/citations?user=PpeDx78AAAAJ&hl=en&authuser=1

#Read in datasheet
SporeCounts <- read.csv("SporeCounts.csv")
SoilTexture <- read.csv("SoilTexture.csv")
samplingData <- read.csv("Sampling.csv")
SoilBiomass <- read.csv("SoilBiomass.csv")
PCRtoSpore <- read.csv("PCRtoSpore.csv")
Key <- read.csv("Key.csv")
names(SoilBiomass)[2] <- "Code"
names(SoilTexture)[3] <- "Code"
names(Key)[2] <- "Code"
names(SporeCounts)[2] <- "Code"

#Only interested in quantity of beetles, subset for type v
volumeData <- subset(samplingData, Type == "v")

#loops a sequence in the column volume, using volume since we are doing math on it.
for(x in seq_along(volumeData[,15]))
  {
  #if NA value is present for beetle...
    if(is.na(volumeData[x,16]))
    {
      #The value of beetles equals the value for volume entered into our equation, 
      #generated by a line of best fit through our scatterplot
    volumeData[x,16] <- (3.06*as.numeric(volumeData[x,15]))-36.5
    }
  #else argument may or may not be necessary, 
  #but for every iteration where we have a value for beetles, we want to keep our value
    else
    {
      volumeData[x,16] <- volumeData[x,16]
    }
      
}

names(volumeData)[2] <- "Code"
Site <- aggregate(Beetles ~ Code, data = volumeData, FUN = max)
aggregate(Beetles~Replicate, data=volumeData,FUN=mean)
Sitex <- aggregate(Beetles ~ Code, data = volumeData, FUN = max)
SiteData <- merge(Site, Key, by="Code")
SiteDatax <- merge(Sitex, Key, by="Code")

TW <- subset(Site, Code == "TW")
CO <- subset(Site, Code == "CO")
FS <- subset(Site, Code == "FS")
HI <- subset(Site, Code == "HI")
ME <- subset(Site, Code == "ME")
FG <- subset(Site, Code == "FG")
LP <- subset(Site, Code == "LP")
TS <- subset(Site, Code == "TS")
PG <- subset(Site, Code == "PG")
LG <- subset(Site, Code == "LG")
LO <- subset(Site, Code == "LO")
SG <- subset(Site, Code == "SG")
MBRP <- rbind(TW,CO,FS,HI,ME,FG,LP,TS,PG,LG,LO,SG)

MB <- lm(Beetles ~ Code, data=MBRP)
anova(MB)
```

#Volume to quantity graph
```{r}
volumeDatax <- subset(volumeData, Beetles > -1)
volumeDatax1 <- subset(volumeDatax, VolBeetles >-1)
volumeDatax1$VolBeetles <- as.numeric(volumeDatax1$VolBeetles)

png("VoltoCount.png", width=6, height=6, units="in", res=400)
ggplot(volumeDatax1,aes(VolBeetles, Beetles)) +
  #stat_summary(fun.data=mean_cl_normal) + 
   geom_point(aes(x=VolBeetles, y=Beetles), data = volumeDatax1, position = position_jitter(w = 0.05, h = 0)) +
  geom_smooth(method='lm', formula= y~x) +
    theme_classic()+
  theme(axis.text=element_text(size=25, family="Arial"),
        axis.title.x = element_text(size=25, family="Arial"),
        axis.text.x = element_text(size=25, color="black", hjust = .5, family="Arial"),
        legend.text = element_text(size=25, family="Arial"),
        legend.title = element_text(size=25, family="Arial"),
        axis.title.y = element_text(size=25, family="Arial"))+
    scale_y_continuous("Number of Beetles")+
  scale_x_continuous("Volume of Beetles (mL)")+
  stat_poly_eq(use_label(c("eq", "R2")))
dev.off()
```


#PCR to Spore Count correlation - will likely need this again
```{r}

PCRtoSporeI <- subset(PCRtoSpore, X..Infection..96.ind.>9)
PCRtoSporeI <- subset(PCRtoSporeI, Average.Spores > 0)

PCR <-lm(Average.Spores~Pred..Spore.Count.Beetle..qPCR., data = PCRtoSporeI)
anova(PCR)

Corr1 <- subset(PCRtoSporeI, Pred..Spore.Count.Beetle..qPCR. > -1)
Corr <- subset(Corr1, Average.Spores > -1)

png("PCRCorrelation.png", width=6, height=6, units="in", res=400)
ggplot(aes(x=Average.Spores, y=Pred..Spore.Count.Beetle..qPCR.), data=Corr)+
  geom_point()+
  geom_smooth(method="lm", se=FALSE, fullrange=TRUE)+
  theme_classic()+
  theme(axis.text=element_text(size=15, family="Arial"),
        axis.title.x = element_text(size=25, family="Arial"),
        axis.text.x = element_text(size=25, color="black", hjust = .5, family="Arial"),
        legend.text = element_text(size=25, family="Arial"),
        legend.title = element_text(size=25, family="Arial"),
        axis.title.y = element_text(size=25, family="Arial"))+
  scale_color_manual(name="", values=c("gray36"))+
  scale_y_continuous("Predicted number of spores (PCR)", expand=c(0,0))+
  scale_x_continuous("Number of spores (Counts)")
dev.off()

png("PCRCorrelation.png", width=6, height=6, units="in", res=400)
ggplot(SPPCR1,aes(PCR, prevalence)) +
 # stat_summary(fun.data=mean_cl_normal) + 
   geom_point(aes(x=PCR, y=prevalence), data = SPPCR1, position = position_jitter(w = 0.05, h = 0)) +
  geom_smooth(method='lm', formula= y~x) +
    theme_classic()+
  theme(axis.text=element_text(size=25, family="Arial"),
        axis.title.x = element_text(size=25, family="Arial"),
        axis.text.x = element_text(size=25, color="black", hjust = .5, family="Arial"),
        legend.text = element_text(size=25, family="Arial"),
        legend.title = element_text(size=25, family="Arial"),
        axis.title.y = element_text(size=25, family="Arial"))+
    scale_y_continuous("Predicted number of spores (PCR)")+
  scale_x_continuous("Number of spores (Counts)")
dev.off()
```

#Beetle number vs. spores
```{r}
library(ggplot2)
library(ggpmisc)
library(Hmisc)

volumeDataSporesInf <- subset(volumeDataSpores, Infected ==1)

LR1 <- glmmTMB(Infected ~ Beetles + (1|Code) + (1|TimeCollected), family = binomial(link = "logit"), data = volumeDataSpores)
Anova(LR1)

plot(simulateResiduals(LR1)) 
hist(simulateResiduals(LR1))


png("Infected.png", width=6, height=6, units="in", res=400)
ggplot(volumeDataSpores,aes(Beetles, Infected)) +
  #stat_summary(fun.data=mean_cl_normal) + 
   geom_point(aes(x=Beetles, y=Infected), data = volumeDataSpores, position = position_jitter(w = 0.05, h = 0)) +
  geom_smooth(method='glm', method.args=list(family="binomial"), formula= y~x) +
    theme_classic()+
  theme(axis.text=element_text(size=25, family="Arial"),
        axis.title.x = element_text(size=25, family="Arial"),
        axis.text.x = element_text(size=25, color="black", hjust = .5, family="Arial"),
        legend.text = element_text(size=25, family="Arial"),
        legend.title = element_text(size=25, family="Arial"),
        axis.title.y = element_text(size=25, family="Arial"))+
    scale_y_continuous("Ovavesicula Infection")+
  scale_x_continuous("Number of Beetles")
dev.off()

volumeDataSporesInf$AvgSpores.L <- log(volumeDataSporesInf$AvgSpores)

LR1 <- glmmTMB(AvgSpores.L ~ Beetles + (1|Code) + (1|TimeCollected), data = volumeDataSporesInf)
Anova(LR1)

plot(simulateResiduals(LR1)) 
hist(simulateResiduals(LR1))

png("InfectionLog.png", width=6, height=6, units="in", res=400)
ggplot(volumeDataSporesInf,aes(Beetles, AvgSpores.L)) +
  #stat_summary(fun.data=mean_cl_normal) + 
   geom_point(aes(x=Beetles, y=AvgSpores.L), data = volumeDataSporesInf, position = position_jitter(w = 0.05, h = 0)) +
  geom_smooth(method='glm.nb', formula= y~x) +
    theme_classic()+
  theme(axis.text=element_text(size=25, family="Arial"),
        axis.title.x = element_text(size=25, family="Arial"),
        axis.text.x = element_text(size=25, color="black", hjust = .5, family="Arial"),
        legend.text = element_text(size=25, family="Arial"),
        legend.title = element_text(size=25, family="Arial"),
        axis.title.y = element_text(size=25, family="Arial"))+
    scale_y_continuous("Log(Ovavesicula Infection)")+
  scale_x_continuous("Number of Beetles")
dev.off()
```

#Beetles vs. Biomass
```{r}
Parameters <- merge(SporeCounts, SoilTexture, by= c("Site", "Collected"))
Parameters <- as.data.frame(Parameters[c(1,2,6,7,11:22)])


volumeDataSpores <- merge(volumeData, SporeCounts, by=c("Code", "Collected"))
volumeDataSoilSpore <- merge(volumeDataSpores, SoilTexture, by=c("Code", "Collected"))
volumeDataSoil <- merge(volumeData, SoilTexture, by=c("Code", "Collected"))
volumeDataBio <- merge(volumeData, SoilBiomass, by = c("Code", "Collected"))
volumeDataBioSpore <- merge(volumeDataBio, SporeCounts, by=c("Code", "Collected"))
volumeDataSoilSporeInf <- subset(volumeDataSoilSpore, Infected==1)

```

##Total Biomass
```{r}
png("Beetles.png", width=6, height=6, units="in", res=400)
ggplot(volumeDataBio, aes(x=Beetles)) + geom_histogram()
dev.off()

Summaries <- summarySE(volumeDataBio, measurevar="Beetles", groupvars=)

LR1 <- lm(Beetles ~ Total.Biomass, data = volumeDataBio)
anova(LR1)

png("Total Biomass.png", width=6, height=6, units="in", res=400)
ggplot(volumeDataBio, aes(x=Total.Biomass)) + geom_histogram()
dev.off()

png("Total BiomassPlot.png", width=6, height=6, units="in", res=400)
ggplot(volumeDataBio,aes(Total.Biomass, Beetles)) +
  stat_summary(fun.data=mean_cl_normal) + 
   geom_point(aes(x=Total.Biomass, y=Beetles), data = volumeDataBio, position = position_jitter(w = 0.05, h = 0)) +
  geom_smooth(method='lm', formula= y~x) +
    theme_classic()+
  theme(axis.text=element_text(size=25, family="Arial"),
        axis.title.x = element_text(size=25, family="Arial"),
        axis.text.x = element_text(size=25, color="black", hjust = .5, family="Arial"),
        legend.text = element_text(size=25, family="Arial"),
        legend.title = element_text(size=25, family="Arial"),
        axis.title.y = element_text(size=25, family="Arial"))+
    scale_x_continuous("Total.Biomass")+
  scale_y_continuous("Number of Beetles")+
    stat_fit_glance(method = 'lm',
                       method.args = list(formula = y~x),
                       geom = 'text',
                       aes(label = paste("P-value = ", signif(..p.value.., digits = 4), sep = "")))
dev.off()

LR1 <- glm(Infected ~ Total.Biomass, family=binomial(link="logit"), data = volumeDataBioSpore)
Anova(LR1)
summary(LR1)
```
##Total Bacteria Biomass
```{r}
LR1 <- lm(Beetles ~ Total.Bacteria.Biomass, data = volumeDataBio)
anova(LR1)

png("Total Bacteria Biomass.png", width=6, height=6, units="in", res=400)
ggplot(volumeDataBio, aes(x=Total.Bacteria.Biomass)) + geom_histogram()
dev.off()

png("Total Bacteria BiomassPlot.png", width=6, height=6, units="in", res=400)
ggplot(volumeDataBio,aes(Total.Bacteria.Biomass, Beetles)) +
  stat_summary(fun.data=mean_cl_normal) + 
   geom_point(aes(x=Total.Bacteria.Biomass, y=Beetles), data = volumeDataBio, position = position_jitter(w = 0.05, h = 0)) +
  geom_smooth(method='lm', formula= y~x) +
    theme_classic()+
  theme(axis.text=element_text(size=25, family="Arial"),
        axis.title.x = element_text(size=25, family="Arial"),
        axis.text.x = element_text(size=25, color="black", hjust = .5, family="Arial"),
        legend.text = element_text(size=25, family="Arial"),
        legend.title = element_text(size=25, family="Arial"),
        axis.title.y = element_text(size=25, family="Arial"))+
    scale_x_continuous("Total.Bacteria.Biomass")+
  scale_y_continuous("Number of Beetles")+
    stat_fit_glance(method = 'lm',
                       method.args = list(formula = y~x),
                       geom = 'text',
                       aes(label = paste("P-value = ", signif(..p.value.., digits = 4), sep = "")))
dev.off()
```
##Total Fungi Biomass
```{r}
LR1 <- lm(Beetles ~ Total.Fungi.Biomass, data = volumeDataBio)
anova(LR1)

png("Total Fungi Biomass.png", width=6, height=6, units="in", res=400)
ggplot(volumeDataBio, aes(x=Total.Fungi.Biomass)) + geom_histogram()
dev.off()

png("Total Fungi BiomassPlot.png", width=6, height=6, units="in", res=400)
ggplot(volumeDataBio,aes(Total.Fungi.Biomass, Beetles)) +
  stat_summary(fun.data=mean_cl_normal) + 
   geom_point(aes(x=Total.Fungi.Biomass, y=Beetles), data = volumeDataBio, position = position_jitter(w = 0.05, h = 0)) +
  geom_smooth(method='lm', formula= y~x) +
    theme_classic()+
  theme(axis.text=element_text(size=25, family="Arial"),
        axis.title.x = element_text(size=25, family="Arial"),
        axis.text.x = element_text(size=25, color="black", hjust = .5, family="Arial"),
        legend.text = element_text(size=25, family="Arial"),
        legend.title = element_text(size=25, family="Arial"),
        axis.title.y = element_text(size=25, family="Arial"))+
    scale_x_continuous("Total.Fungi.Biomass")+
  scale_y_continuous("Number of Beetles")+
    stat_fit_glance(method = 'lm',
                       method.args = list(formula = y~x),
                       geom = 'text',
                       aes(label = paste("P-value = ", signif(..p.value.., digits = 4), sep = "")))
dev.off()
```

##Bacteria Percent
```{r}
LR1 <- lm(Beetles ~ Bacteria.., data = volumeDataBio)
anova(LR1)

png("BacteriaPercent.png", width=6, height=6, units="in", res=400)
ggplot(volumeDataBio, aes(x=Bacteria..)) + geom_histogram()
dev.off()

png("Bacteria PercentPlot.png", width=6, height=6, units="in", res=400)
ggplot(volumeDataBio,aes(Bacteria.., Beetles)) +
  stat_summary(fun.data=mean_cl_normal) + 
   geom_point(aes(x=Bacteria.., y=Beetles), data = volumeDataBio, position = position_jitter(w = 0.05, h = 0)) +
  geom_smooth(method='lm', formula= y~x) +
    theme_classic()+
  theme(axis.text=element_text(size=25, family="Arial"),
        axis.title.x = element_text(size=25, family="Arial"),
        axis.text.x = element_text(size=25, color="black", hjust = .5, family="Arial"),
        legend.text = element_text(size=25, family="Arial"),
        legend.title = element_text(size=25, family="Arial"),
        axis.title.y = element_text(size=25, family="Arial"))+
    scale_x_continuous("Bacteria Percent Biomass")+
  scale_y_continuous("Number of Beetles")+
    stat_fit_glance(method = 'lm',
                       method.args = list(formula = y~x),
                       geom = 'text',
                       aes(label = paste("P-value = ", signif(..p.value.., digits = 4), sep = "")))
dev.off()
```

##Fungi Percent
```{r}
LR1 <- lm(Beetles ~ Total.Fungi.., data = volumeDataBio)
anova(LR1)

png("FungiPercent.png", width=6, height=6, units="in", res=400)
ggplot(volumeDataBio, aes(x=Total.Fungi..)) + geom_histogram()
dev.off()

png("Fungi Percent BiomassPlot.png", width=6, height=6, units="in", res=400)
ggplot(volumeDataBio,aes(Total.Fungi.., Beetles)) +
  stat_summary(fun.data=mean_cl_normal) + 
   geom_point(aes(x=Total.Fungi.., y=Beetles), data = volumeDataBio, position = position_jitter(w = 0.05, h = 0)) +
  geom_smooth(method='lm', formula= y~x) +
    theme_classic()+
  theme(axis.text=element_text(size=25, family="Arial"),
        axis.title.x = element_text(size=25, family="Arial"),
        axis.text.x = element_text(size=25, color="black", hjust = .5, family="Arial"),
        legend.text = element_text(size=25, family="Arial"),
        legend.title = element_text(size=25, family="Arial"),
        axis.title.y = element_text(size=25, family="Arial"))+
    scale_x_continuous("Fungi Percent Biomass")+
  scale_y_continuous("Number of Beetles")+
    stat_fit_glance(method = 'lm',
                       method.args = list(formula = y~x),
                       geom = 'text',
                       aes(label = paste("P-value = ", signif(..p.value.., digits = 4), sep = "")))
dev.off()
```

##Fungi to Bacteria Ratio
```{r}
LR1 <- lm(Beetles ~ Fungi.Bacteria, data = volumeDataBio)
anova(LR1)

png("FungitoBacteria.png", width=6, height=6, units="in", res=400)
ggplot(volumeDataBio, aes(x=Fungi.Bacteria)) + geom_histogram()
dev.off()

png("FungitoBacteriaPlot.png", width=6, height=6, units="in", res=400)
ggplot(volumeDataBio,aes(Fungi.Bacteria, Beetles)) +
  stat_summary(fun.data=mean_cl_normal) + 
   geom_point(aes(x=Fungi.Bacteria, y=Beetles), data = volumeDataBio) +
  geom_smooth(method='lm', formula= y~x) +
    theme_classic()+
  theme(axis.text=element_text(size=25, family="Arial"),
        axis.title.x = element_text(size=25, family="Arial"),
        axis.text.x = element_text(size=25, color="black", hjust = .5, family="Arial"),
        legend.text = element_text(size=25, family="Arial"),
        legend.title = element_text(size=25, family="Arial"),
        axis.title.y = element_text(size=25, family="Arial"))+
    scale_x_continuous("Fungi to Bacteria Ratio")+
  scale_y_continuous("Number of Beetles")+
    stat_fit_glance(method = 'lm',
                       method.args = list(formula = y~x),
                       geom = 'text',
                       aes(label = paste("P-value = ", signif(..p.value.., digits = 4), sep = "")))
dev.off()


```

#Soil Correlations
##Ph
```{r}
library(ggplot2)
library(ggpmisc)
library(Hmisc)

LR1 <- lm(Ph ~ Beetles, data = volumeDataSoil)
anova(LR1)

png("SoilPh.png", width=6, height=6, units="in", res=400)
ggplot(volumeDataSoil,aes(Ph, Beetles)) +
  stat_summary(fun.data=mean_cl_normal) + 
   geom_point(aes(x=Ph, y=Beetles), data = volumeDataSoil, position = position_jitter(w = 0.05, h = 0)) +
  geom_smooth(method='lm', formula= y~x) +
    theme_classic()+
  theme(axis.text=element_text(size=25, family="Arial"),
        axis.title.x = element_text(size=25, family="Arial"),
        axis.text.x = element_text(size=25, color="black", hjust = .5, family="Arial"),
        legend.text = element_text(size=25, family="Arial"),
        legend.title = element_text(size=25, family="Arial"),
        axis.title.y = element_text(size=25, family="Arial"))+
    scale_x_continuous("Ph")+
  scale_y_continuous("Number of Beetles")+
    stat_fit_glance(method = 'lm',
                       method.args = list(formula = y~x),
                       geom = 'text',
                       aes(label = paste("P-value = ", signif(..p.value.., digits = 4), sep = "")))
dev.off()

LR1 <- glm(Infected ~ Ph, family=binomial(link="logit"), data = volumeDataSoilSpore)
Anova(LR1)

png("SoilPh.png", width=6, height=6, units="in", res=400)
ggplot(volumeDataSoilSpore,aes(Ph, AvgSpores)) +
  #stat_summary(fun.data=mean_cl_normal) + 
   geom_point(aes(x=Ph, y=AvgSpores), data = volumeDataSoilSpore, position = position_jitter(w = 0.05, h = 0)) +
  geom_smooth(method='lm', formula= y~x) +
    theme_classic()+
  theme(axis.text=element_text(size=25, family="Arial"),
        axis.title.x = element_text(size=25, family="Arial"),
        axis.text.x = element_text(size=25, color="black", hjust = .5, family="Arial"),
        legend.text = element_text(size=25, family="Arial"),
        legend.title = element_text(size=25, family="Arial"),
        axis.title.y = element_text(size=25, family="Arial"))+
    scale_x_continuous("Ph")+
  scale_y_continuous("Number of Spores")+
    stat_fit_glance(method = 'lm',
                       method.args = list(formula = y~x),
                       geom = 'text',
                       aes(label = paste("P-value = ", signif(..p.value.., digits = 4), sep = "")))
dev.off()

volumeDataSoilSporeInf$AvgSpores.L <- log(volumeDataSoilSporeInf$AvgSpores) 

LR1 <- lm(AvgSpores.L ~ Ph, data = volumeDataSoilSporeInf)
anova(LR1)

plot(simulateResiduals(LR1)) 
hist(simulateResiduals(LR1))
```

##Bray.P
```{r}
library(ggplot2)
library(ggpmisc)

LR1 <- lm(Bray.P ~ Beetles, data = volumeDataSoil)
anova(LR1)

png("SoilP.png", width=6, height=6, units="in", res=400)
ggplot(volumeDataSoil,aes(Bray.P, Beetles)) +
  #stat_summary(fun.data=mean_cl_normal) + 
   geom_point(aes(x=Bray.P, y=Beetles), data = volumeDataSoil, position = position_jitter(w = 0.05, h = 0)) +
  geom_smooth(method='lm', formula= y~x) +
    theme_classic()+
  theme(axis.text=element_text(size=25, family="Arial"),
        axis.title.x = element_text(size=25, family="Arial"),
        axis.text.x = element_text(size=25, color="black", hjust = .5, family="Arial"),
        legend.text = element_text(size=25, family="Arial"),
        legend.title = element_text(size=25, family="Arial"),
        axis.title.y = element_text(size=25, family="Arial"))+
    scale_x_continuous("Bray P")+
  scale_y_continuous("Number of Beetles")+
    stat_fit_glance(method = 'lm',
                       method.args = list(formula = y~x),
                       geom = 'text',
                       aes(label = paste("P-value = ", signif(..p.value.., digits = 4), sep = "")))
dev.off()

LR1 <- glm(Infected ~ Bray.P, family=binomial(link="logit"), data = volumeDataSoilSpore)
Anova(LR1)

png("SoilP.png", width=6, height=6, units="in", res=400)
ggplot(volumeDataSoilSpore,aes(Bray.P, AvgSpores)) +
 # stat_summary(fun.data=mean_cl_normal) + 
   geom_point(aes(x=Bray.P, y=AvgSpores), data = volumeDataSoilSpore, position = position_jitter(w = 0.05, h = 0)) +
  geom_smooth(method='lm', formula= y~x) +
    theme_classic()+
  theme(axis.text=element_text(size=25, family="Arial"),
        axis.title.x = element_text(size=25, family="Arial"),
        axis.text.x = element_text(size=25, color="black", hjust = .5, family="Arial"),
        legend.text = element_text(size=25, family="Arial"),
        legend.title = element_text(size=25, family="Arial"),
        axis.title.y = element_text(size=25, family="Arial"))+
    scale_x_continuous("Bray P")+
  scale_y_continuous("Number of Beetles")+
    stat_fit_glance(method = 'lm',
                       method.args = list(formula = y~x),
                       geom = 'text',
                       aes(label = paste("P-value = ", signif(..p.value.., digits = 4), sep = "")))
dev.off()

LR1 <- lm(AvgSpores.L ~ Bray.P, data = volumeDataSoilSporeInf)
anova(LR1)
summary(LR1)

png("SoilPSpores.png", width=6, height=6, units="in", res=400)
ggplot(volumeDataSoilSporeInf,aes(Bray.P, AvgSpores.L)) +
 # stat_summary(fun.data=mean_cl_normal) + 
   geom_point(aes(x=Bray.P, y=AvgSpores.L), data = volumeDataSoilSporeInf, position = position_jitter(w = 0.05, h = 0)) +
  geom_smooth(method='lm', formula= y~x) +
    theme_classic()+
  theme(axis.text=element_text(size=25, family="Arial"),
        axis.title.x = element_text(size=25, family="Arial"),
        axis.text.x = element_text(size=25, color="black", hjust = .5, family="Arial"),
        legend.text = element_text(size=25, family="Arial"),
        legend.title = element_text(size=25, family="Arial"),
        axis.title.y = element_text(size=25, family="Arial"))+
    scale_x_continuous("Bray P")+
  scale_y_continuous("Log(Number of Spores)")
dev.off()
```

##NH4OAc.K
```{r}
library(ggplot2)
library(ggpmisc)

LR1 <- lm(NH4OAc.K ~ Beetles, data = volumeDataSoil)
anova(LR1)

png("SoilP.png", width=6, height=6, units="in", res=400)
ggplot(volumeDataSoil,aes(NH4OAc.K, Beetles)) +
  stat_summary(fun.data=mean_cl_normal) + 
   geom_point(aes(x=NH4OAc.K, y=Beetles), data = volumeDataSoil, position = position_jitter(w = 0.05, h = 0)) +
  geom_smooth(method='lm', formula= y~x) +
    theme_classic()+
  theme(axis.text=element_text(size=25, family="Arial"),
        axis.title.x = element_text(size=25, family="Arial"),
        axis.text.x = element_text(size=25, color="black", hjust = .5, family="Arial"),
        legend.text = element_text(size=25, family="Arial"),
        legend.title = element_text(size=25, family="Arial"),
        axis.title.y = element_text(size=25, family="Arial"))+
    scale_x_continuous("NH4OAc.K")+
  scale_y_continuous("Number of Beetles")+
    stat_fit_glance(method = 'lm',
                       method.args = list(formula = y~x),
                       geom = 'text',
                       aes(label = paste("P-value = ", signif(..p.value.., digits = 4), sep = "")))
dev.off()

LR1 <- glm(Infected ~ NH4OAc.K, family=binomial(link="logit"), data = volumeDataSoilSpore)
Anova(LR1)

png("SoilP.png", width=6, height=6, units="in", res=400)
ggplot(volumeDataSoilSpore,aes(NH4OAc.K, AvgSpores)) +
  #stat_summary(fun.data=mean_cl_normal) + 
   geom_point(aes(x=NH4OAc.K, y=AvgSpores), data = volumeDataSoilSpore, position = position_jitter(w = 0.05, h = 0)) +
  geom_smooth(method='lm', formula= y~x) +
    theme_classic()+
  theme(axis.text=element_text(size=25, family="Arial"),
        axis.title.x = element_text(size=25, family="Arial"),
        axis.text.x = element_text(size=25, color="black", hjust = .5, family="Arial"),
        legend.text = element_text(size=25, family="Arial"),
        legend.title = element_text(size=25, family="Arial"),
        axis.title.y = element_text(size=25, family="Arial"))+
    scale_x_continuous("NH4OAc.K")+
  scale_y_continuous("Number of Spores")+
    stat_fit_glance(method = 'lm',
                       method.args = list(formula = y~x),
                       geom = 'text',
                       aes(label = paste("P-value = ", signif(..p.value.., digits = 4), sep = "")))
dev.off()

LR1 <- lm(AvgSpores.L ~ NH4OAc.K, data = volumeDataSoilSporeInf)
anova(LR1)

png("SoilKSpores.png", width=6, height=6, units="in", res=400)
ggplot(volumeDataSoilSporeInf,aes(NH4OAc.K, AvgSpores.L)) +
 # stat_summary(fun.data=mean_cl_normal) + 
   geom_point(aes(x=NH4OAc.K, y=AvgSpores.L), data = volumeDataSoilSporeInf, position = position_jitter(w = 0.05, h = 0)) +
  geom_smooth(method='lm', formula= y~x) +
    theme_classic()+
  theme(axis.text=element_text(size=25, family="Arial"),
        axis.title.x = element_text(size=25, family="Arial"),
        axis.text.x = element_text(size=25, color="black", hjust = .5, family="Arial"),
        legend.text = element_text(size=25, family="Arial"),
        legend.title = element_text(size=25, family="Arial"),
        axis.title.y = element_text(size=25, family="Arial"))+
    scale_x_continuous("Potassium")+
  scale_y_continuous("Log(Number of Spores)")
dev.off()
```

##LOI.OM
```{r}
library(ggplot2)
library(ggpmisc)

LR1 <- lm(Beetles ~ LOI.OM, data = volumeDataSoil)
anova(LR1)

png("SoilP.png", width=6, height=6, units="in", res=400)
ggplot(volumeDataSoil,aes(LOI.OM, Beetles)) +
  stat_summary(fun.data=mean_cl_normal) + 
   geom_point(aes(x=LOI.OM, y=Beetles), data = volumeDataSoil, position = position_jitter(w = 0.05, h = 0)) +
  geom_smooth(method='lm', formula= y~x) +
    theme_classic()+
  theme(axis.text=element_text(size=25, family="Arial"),
        axis.title.x = element_text(size=25, family="Arial"),
        axis.text.x = element_text(size=25, color="black", hjust = .5, family="Arial"),
        legend.text = element_text(size=25, family="Arial"),
        legend.title = element_text(size=25, family="Arial"),
        axis.title.y = element_text(size=25, family="Arial"))+
    scale_x_continuous("LOI.OM")+
  scale_y_continuous("Number of Beetles")+
    stat_fit_glance(method = 'lm',
                       method.args = list(formula = y~x),
                       geom = 'text',
                       aes(label = paste("P-value = ", signif(..p.value.., digits = 4), sep = "")))
dev.off()

LR1 <- glm(Infected ~ LOI.OM, family=binomial(link="logit"), data = volumeDataSoilSpore)
Anova(LR1)

png("SoilP.png", width=6, height=6, units="in", res=400)
ggplot(volumeDataSoilSpore,aes(LOI.OM, AvgSpores)) +
  #stat_summary(fun.data=mean_cl_normal) + 
   geom_point(aes(x=LOI.OM, y=AvgSpores), data = volumeDataSoilSpore, position = position_jitter(w = 0.05, h = 0)) +
  geom_smooth(method='lm', formula= y~x) +
    theme_classic()+
  theme(axis.text=element_text(size=25, family="Arial"),
        axis.title.x = element_text(size=25, family="Arial"),
        axis.text.x = element_text(size=25, color="black", hjust = .5, family="Arial"),
        legend.text = element_text(size=25, family="Arial"),
        legend.title = element_text(size=25, family="Arial"),
        axis.title.y = element_text(size=25, family="Arial"))+
    scale_x_continuous("LOI.OM")+
  scale_y_continuous("Number of Beetles")+
    stat_fit_glance(method = 'lm',
                       method.args = list(formula = y~x),
                       geom = 'text',
                       aes(label = paste("P-value = ", signif(..p.value.., digits = 4), sep = "")))
dev.off()

LR1 <- lm(AvgSpores.L ~ LOI.OM, data = volumeDataSoilSporeInf)
anova(LR1)
```

##NO3.N
```{r}
library(ggplot2)
library(ggpmisc)

LR1 <- lm(Beetles ~ NO3.N, data = volumeDataSoil)
anova(LR1)

png("SoilP.png", width=6, height=6, units="in", res=400)
ggplot(volumeDataSoil,aes(NO3.N, Beetles)) +
  stat_summary(fun.data=mean_cl_normal) + 
   geom_point(aes(x=NO3.N, y=Beetles), data = volumeDataSoil, position = position_jitter(w = 0.05, h = 0)) +
  geom_smooth(method='lm', formula= y~x) +
    theme_classic()+
  theme(axis.text=element_text(size=25, family="Arial"),
        axis.title.x = element_text(size=25, family="Arial"),
        axis.text.x = element_text(size=25, color="black", hjust = .5, family="Arial"),
        legend.text = element_text(size=25, family="Arial"),
        legend.title = element_text(size=25, family="Arial"),
        axis.title.y = element_text(size=25, family="Arial"))+
    scale_x_continuous("NO3.N")+
  scale_y_continuous("Number of Beetles")+
    stat_fit_glance(method = 'lm',
                       method.args = list(formula = y~x),
                       geom = 'text',
                       aes(label = paste("P-value = ", signif(..p.value.., digits = 4), sep = "")))
dev.off()

LR1 <- glm(Infected ~ NO3.N, family=binomial(link="logit"), data = volumeDataSoilSpore)
Anova(LR1)

png("SoilP.png", width=6, height=6, units="in", res=400)
ggplot(volumeDataSoilSpore,aes(NO3.N, AvgSpores)) +
 # stat_summary(fun.data=mean_cl_normal) + 
   geom_point(aes(x=NO3.N, y=AvgSpores), data = volumeDataSoilSpore, position = position_jitter(w = 0.05, h = 0)) +
  geom_smooth(method='lm', formula= y~x) +
    theme_classic()+
  theme(axis.text=element_text(size=25, family="Arial"),
        axis.title.x = element_text(size=25, family="Arial"),
        axis.text.x = element_text(size=25, color="black", hjust = .5, family="Arial"),
        legend.text = element_text(size=25, family="Arial"),
        legend.title = element_text(size=25, family="Arial"),
        axis.title.y = element_text(size=25, family="Arial"))+
    scale_x_continuous("NO3.N")+
  scale_y_continuous("Number of Spores")+
    stat_fit_glance(method = 'lm',
                       method.args = list(formula = y~x),
                       geom = 'text',
                       aes(label = paste("P-value = ", signif(..p.value.., digits = 4), sep = "")))
dev.off()

LR1 <- lm(AvgSpores.L ~ NO3.N, data = volumeDataSoilSporeInf)
anova(LR1)

png("SoilNSpores.png", width=6, height=6, units="in", res=400)
ggplot(volumeDataSoilSporeInf,aes(NO3.N, AvgSpores.L)) +
 # stat_summary(fun.data=mean_cl_normal) + 
   geom_point(aes(x=NO3.N, y=AvgSpores.L), data = volumeDataSoilSporeInf, position = position_jitter(w = 0.05, h = 0)) +
  geom_smooth(method='lm', formula= y~x) +
    theme_classic()+
  theme(axis.text=element_text(size=25, family="Arial"),
        axis.title.x = element_text(size=25, family="Arial"),
        axis.text.x = element_text(size=25, color="black", hjust = .5, family="Arial"),
        legend.text = element_text(size=25, family="Arial"),
        legend.title = element_text(size=25, family="Arial"),
        axis.title.y = element_text(size=25, family="Arial"))+
    scale_x_continuous("NO3, Nitrogen")+
  scale_y_continuous("Log(Number of Spores)")
dev.off()
```

##Moisture
```{r}
library(ggplot2)
library(ggpmisc)

LR1 <- lm(Beetles ~ Moisture, data = volumeDataSoil)
anova(LR1)

png("SoilMoisture.png", width=6, height=6, units="in", res=400)
ggplot(volumeDataSoil,aes(Moisture, Beetles)) +
  #stat_summary(fun.data=mean_cl_normal) + 
   geom_point(aes(x=Moisture, y=Beetles), data = volumeDataSoil, position = position_jitter(w = 0.05, h = 0)) +
  geom_smooth(method='lm', formula= y~x) +
    theme_classic()+
  theme(axis.text=element_text(size=25, family="Arial"),
        axis.title.x = element_text(size=25, family="Arial"),
        axis.text.x = element_text(size=25, color="black", hjust = .5, family="Arial"),
        legend.text = element_text(size=25, family="Arial"),
        legend.title = element_text(size=25, family="Arial"),
        axis.title.y = element_text(size=25, family="Arial"))+
    scale_x_continuous("% Moisture")+
  scale_y_continuous("Number of Beetles")+
    stat_fit_glance(method = 'lm',
                       method.args = list(formula = y~x),
                       geom = 'text',
                       aes(label = paste("P-value = ", signif(..p.value.., digits = 4), sep = "")))
dev.off()

LR1 <- glm(Infected ~ Moisture, family=binomial(link="logit"), data = volumeDataSoilSpore)
Anova(LR1)

png("SoilMoisture.png", width=6, height=6, units="in", res=400)
ggplot(volumeDataSoilSpore,aes(Moisture, AvgSpores)) +
  #stat_summary(fun.data=mean_cl_normal) + 
   geom_point(aes(x=Moisture, y=AvgSpores), data = volumeDataSoilSpore, position = position_jitter(w = 0.05, h = 0)) +
  geom_smooth(method='lm', formula= y~x) +
    theme_classic()+
  theme(axis.text=element_text(size=25, family="Arial"),
        axis.title.x = element_text(size=25, family="Arial"),
        axis.text.x = element_text(size=25, color="black", hjust = .5, family="Arial"),
        legend.text = element_text(size=25, family="Arial"),
        legend.title = element_text(size=25, family="Arial"),
        axis.title.y = element_text(size=25, family="Arial"))+
    scale_x_continuous("% Moisture")+
  scale_y_continuous("Number of Beetles")+
    stat_fit_glance(method = 'lm',
                       method.args = list(formula = y~x),
                       geom = 'text',
                       aes(label = paste("P-value = ", signif(..p.value.., digits = 4), sep = "")))
dev.off()

LR1 <- lm(AvgSpores.L ~ Moisture, data = volumeDataSoilSporeInf)
anova(LR1)

```

##Solid
```{r}
library(ggplot2)
library(ggpmisc)

LR1 <- lm(Beetles ~ Solid, data = volumeDataSoil)
anova(LR1)

png("Solids.png", width=6, height=6, units="in", res=400)
ggplot(volumeDataSoil,aes(Solid, Beetles)) +
  #stat_summary(fun.data=mean_cl_normal) + 
   geom_point(aes(x=Solid, y=Beetles), data = volumeDataSoil, position = position_jitter(w = 0.05, h = 0)) +
  geom_smooth(method='lm', formula= y~x) +
    theme_classic()+
  theme(axis.text=element_text(size=25, family="Arial"),
        axis.title.x = element_text(size=25, family="Arial"),
        axis.text.x = element_text(size=25, color="black", hjust = .5, family="Arial"),
        legend.text = element_text(size=25, family="Arial"),
        legend.title = element_text(size=25, family="Arial"),
        axis.title.y = element_text(size=25, family="Arial"))+
    scale_x_continuous("% Solid")+
  scale_y_continuous("Number of Beetles")+
    stat_fit_glance(method = 'lm',
                       method.args = list(formula = y~x),
                       geom = 'text',
                       aes(label = paste("P-value = ", signif(..p.value.., digits = 4), sep = "")))
dev.off()

LR1 <- glm(Infected ~ Solid, family=binomial(link="logit"), data = volumeDataSoilSpore)
Anova(LR1)

png("Solids.png", width=6, height=6, units="in", res=400)
ggplot(volumeDataSoil,aes(Solid, Beetles)) +
  stat_summary(fun.data=mean_cl_normal) + 
   geom_point(aes(x=Solid, y=Beetles), data = volumeDataSoil, position = position_jitter(w = 0.05, h = 0)) +
  geom_smooth(method='lm', formula= y~x) +
    theme_classic()+
  theme(axis.text=element_text(size=25, family="Arial"),
        axis.title.x = element_text(size=25, family="Arial"),
        axis.text.x = element_text(size=25, color="black", hjust = .5, family="Arial"),
        legend.text = element_text(size=25, family="Arial"),
        legend.title = element_text(size=25, family="Arial"),
        axis.title.y = element_text(size=25, family="Arial"))+
    scale_x_continuous("% Solid")+
  scale_y_continuous("Number of Beetles")+
    stat_fit_glance(method = 'lm',
                       method.args = list(formula = y~x),
                       geom = 'text',
                       aes(label = paste("P-value = ", signif(..p.value.., digits = 4), sep = "")))
dev.off()

LR1 <- lm(AvgSpores.L ~ Solid, data = volumeDataSoilSporeInf)
anova(LR1)
```

##Sand
```{r}
library(ggplot2)
library(ggpmisc)

LR1 <- lm(Beetles ~ Sand, data = volumeDataSoil)
anova(LR1)

png("SoilP.png", width=6, height=6, units="in", res=400)
ggplot(volumeDataSoil,aes(Sand, Beetles)) +
  stat_summary(fun.data=mean_cl_normal) + 
   geom_point(aes(x=Sand, y=Beetles), data = volumeDataSoil, position = position_jitter(w = 0.05, h = 0)) +
  geom_smooth(method='lm', formula= y~x) +
    theme_classic()+
  theme(axis.text=element_text(size=25, family="Arial"),
        axis.title.x = element_text(size=25, family="Arial"),
        axis.text.x = element_text(size=25, color="black", hjust = .5, family="Arial"),
        legend.text = element_text(size=25, family="Arial"),
        legend.title = element_text(size=25, family="Arial"),
        axis.title.y = element_text(size=25, family="Arial"))+
    scale_x_continuous("Sand")+
  scale_y_continuous("Number of Beetles")+
    stat_fit_glance(method = 'lm',
                       method.args = list(formula = y~x),
                       geom = 'text',
                       aes(label = paste("P-value = ", signif(..p.value.., digits = 4), sep = "")))
dev.off()

LR1 <- glm(Infected ~ Sand, family=binomial(link="logit"), data = volumeDataSoilSpore)
Anova(LR1)

png("SoilP.png", width=6, height=6, units="in", res=400)
ggplot(volumeDataSoil,aes(Sand, Beetles)) +
  stat_summary(fun.data=mean_cl_normal) + 
   geom_point(aes(x=Sand, y=Beetles), data = volumeDataSoil, position = position_jitter(w = 0.05, h = 0)) +
  geom_smooth(method='lm', formula= y~x) +
    theme_classic()+
  theme(axis.text=element_text(size=25, family="Arial"),
        axis.title.x = element_text(size=25, family="Arial"),
        axis.text.x = element_text(size=25, color="black", hjust = .5, family="Arial"),
        legend.text = element_text(size=25, family="Arial"),
        legend.title = element_text(size=25, family="Arial"),
        axis.title.y = element_text(size=25, family="Arial"))+
    scale_x_continuous("Sand")+
  scale_y_continuous("Number of Beetles")+
    stat_fit_glance(method = 'lm',
                       method.args = list(formula = y~x),
                       geom = 'text',
                       aes(label = paste("P-value = ", signif(..p.value.., digits = 4), sep = "")))
dev.off()

LR1 <- lm(AvgSpores.L ~ Sand, data = volumeDataSoilSporeInf)
anova(LR1)
```

##Silt
```{r}
library(ggplot2)
library(ggpmisc)

LR1 <- lm(Beetles ~ Silt, data = volumeDataSoil)
anova(LR1)

png("SoilP.png", width=6, height=6, units="in", res=400)
ggplot(volumeDataSoil,aes(Silt, Beetles)) +
  stat_summary(fun.data=mean_cl_normal) + 
   geom_point(aes(x=Silt, y=Beetles), data = volumeDataSoil, position = position_jitter(w = 0.05, h = 0)) +
  geom_smooth(method='lm', formula= y~x) +
    theme_classic()+
  theme(axis.text=element_text(size=25, family="Arial"),
        axis.title.x = element_text(size=25, family="Arial"),
        axis.text.x = element_text(size=25, color="black", hjust = .5, family="Arial"),
        legend.text = element_text(size=25, family="Arial"),
        legend.title = element_text(size=25, family="Arial"),
        axis.title.y = element_text(size=25, family="Arial"))+
    scale_x_continuous("Silt")+
  scale_y_continuous("Number of Beetles")+
    stat_fit_glance(method = 'lm',
                       method.args = list(formula = y~x),
                       geom = 'text',
                       aes(label = paste("P-value = ", signif(..p.value.., digits = 4), sep = "")))
dev.off()

LR1 <- glm(Infected ~ Silt, family=binomial(link="logit"), data = volumeDataSoilSpore)
Anova(LR1)

png("SoilP.png", width=6, height=6, units="in", res=400)
ggplot(volumeDataSoil,aes(Silt, Beetles)) +
  stat_summary(fun.data=mean_cl_normal) + 
   geom_point(aes(x=Silt, y=Beetles), data = volumeDataSoil, position = position_jitter(w = 0.05, h = 0)) +
  geom_smooth(method='lm', formula= y~x) +
    theme_classic()+
  theme(axis.text=element_text(size=25, family="Arial"),
        axis.title.x = element_text(size=25, family="Arial"),
        axis.text.x = element_text(size=25, color="black", hjust = .5, family="Arial"),
        legend.text = element_text(size=25, family="Arial"),
        legend.title = element_text(size=25, family="Arial"),
        axis.title.y = element_text(size=25, family="Arial"))+
    scale_x_continuous("Silt")+
  scale_y_continuous("Number of Beetles")+
    stat_fit_glance(method = 'lm',
                       method.args = list(formula = y~x),
                       geom = 'text',
                       aes(label = paste("P-value = ", signif(..p.value.., digits = 4), sep = "")))
dev.off()

LR1 <- lm(AvgSpores.L ~ Silt, data = volumeDataSoilSporeInf)
anova(LR1)
```

##Clay
```{r}
library(ggplot2)
library(ggpmisc)
library(lmerTest)

LR1 <- lm(Beetles ~ Clay, data = volumeDataSoil)
anova(LR1)

png("Clay.png", width=6, height=6, units="in", res=400)
ggplot(volumeDataSoil,aes(Clay, Beetles)) +
  stat_summary(fun.data=mean_cl_normal) + 
   geom_point(aes(x=Clay, y=Beetles), data = volumeDataSoil, position = position_jitter(w = 0.05, h = 0)) +
  geom_smooth(method='lm', formula= y~x) +
    theme_classic()+
  theme(axis.text=element_text(size=25, family="Arial"),
        axis.title.x = element_text(size=25, family="Arial"),
        axis.text.x = element_text(size=25, color="black", hjust = .5, family="Arial"),
        legend.text = element_text(size=25, family="Arial"),
        legend.title = element_text(size=25, family="Arial"),
        axis.title.y = element_text(size=25, family="Arial"))+
    scale_x_continuous("Percent Clay")+
  scale_y_continuous("Number of Beetles")+
    stat_fit_glance(method = 'lm',
                       method.args = list(formula = y~x),
                       geom = 'text',
                       aes(label = paste("P-value = ", signif(..p.value.., digits = 4), sep = "")))
dev.off()

LR1 <- glm(Infected ~ Clay, family=binomial(link="logit"), data = volumeDataSoilSpore)
summary(LR1)
Anova(LR1)

png("ClayInfected.png", width=6, height=6, units="in", res=400)
ggplot(volumeDataSoilSpore,aes(Clay, Infected)) +
  #stat_summary(fun.data=mean_cl_normal) + 
   geom_point(aes(x=Clay, y=Infected), data = volumeDataSoilSpore, position = position_jitter(w = 0.05, h = 0)) +
  geom_smooth(method='glm', family=binomial(link="logit"), formula= y~x) +
    theme_classic()+
  theme(axis.text=element_text(size=25, family="Arial"),
        axis.title.x = element_text(size=25, family="Arial"),
        axis.text.x = element_text(size=25, color="black", hjust = .5, family="Arial"),
        legend.text = element_text(size=25, family="Arial"),
        legend.title = element_text(size=25, family="Arial"),
        axis.title.y = element_text(size=25, family="Arial"))+
    scale_x_continuous("Percent Clay")+
  scale_y_continuous("Infected (0/1)",limit=c(0,1))
   
dev.off()

LR1 <- lm(AvgSpores.L ~ Clay, data = volumeDataSoilSporeInf)
anova(LR1)
```

#Simple graphs
```{r}
volumeData <- merge(volumeData,Key, by="Code")
volumeDataSpores <- merge(volumeData, SporeCounts, by=c("Code", "Collected"))
volumeDataspores <- aggregate(prevalence ~ Code, data = volumeDataSpores, FUN = mean)
volumeDataspores <- merge(volumeDataspores, Key, by="Code")

library(tidyr)
volumeData <- separate(volumeData, col=Coordinates, into=c('X', 'Y'), sep=',')
detach(package:tidyr)

library(tidyr)
volumeDataspores <- separate(volumeDataspores, col=Coordinates, into=c('X', 'Y'), sep=',')
detach(package:tidyr)

Date <- summarySE(volumeData, measurevar="Beetles", groupvars=c("Collected"))
Date <- Date[order(as.Date(Date$Collected, format="%m/%d/%Y")), ]

png("Beetlesbydate.png", width=6, height=6, units="in", res=400)
plot(1:25, Date[,3], xaxt="n", ylim=c(0,2100), xlim=c(1,25), type="b", pch=16, col="blue", xlab="Day", ylab="Number of Beetles", cex=1.5, lty=4, cex.lab=1.5, lwd=2)
axis(1, 1:25, labels=c(Date$Collected))
arrows(1:25, Date[,3]-Date[,"se"], 1:25, Date[,3]+Date[, "se"], code=3, angle=90, length=0.05, lwd=2, col="blue")
dev.off()

Use <- summarySE(volumeData, measurevar="Beetles", groupvars=c("SiteType"))

png("Beetlesbyuse.png", width=6, height=6, units="in", res=400)
plot(1:3, Use[,3], xaxt="n", ylim=c(0,600), xlim=c(1,3), type="b", pch=16, col="blue", xlab="Site Type", ylab="Number of Beetles", cex=1.5, lty=4, cex.lab=1.5, lwd=2)
axis(1, 1:3, labels=c(Use$SiteType))
arrows(1:3, Use[,3]-Use[,"se"], 1:3, Use[,3]+Use[, "se"], code=3, angle=90, length=0.05, lwd=2, col="blue")
dev.off()


```

#Spatial exploration
```{r}

volumeData$X <- as.numeric(volumeData$X)
volumeData$Y <- as.numeric(volumeData$Y)
SiteData$X <- as.numeric(SiteData$X)
SiteData$Y <- as.numeric(SiteData$Y)
write.csv(volumeData, "volumeData.csv")

volumeDataspores$X <- as.numeric(volumeDataspores$X)
volumeDataspores$Y <- as.numeric(volumeDataspores$Y)

volumeDataspores$percent <- volumeDataspores$prevalence * 100

xy <- SiteData[,c("Y","X")]
xy <- volumeDataspores[,c("Y","X")]

Beetles <- merge(Site, Key, by="Site")
library(tidyr)
SiteData <- separate(SiteData, col=Coordinates, into=c('X', 'Y'), sep=',')
detach(package:tidyr)
spdf <- SpatialPointsDataFrame(coords = xy, data = SiteData, proj4string = CRS("+proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0"))
spdf <- SpatialPointsDataFrame(coords = xy, data = volumeData, proj4string = CRS("+proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0"))
spdf <- SpatialPointsDataFrame(coords = xy, data = volumeDataspores, proj4string = CRS("+proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0"))

newpal <- c("#FFFFFF", "#FFCCCB", "#FF0000", "#8B0000", "#000000")
newpal <- c("#edf8fb", "#b3cde3", "#8c96c6", "#8856a7", "#810f7c")

map <- mapview(spdf, col.regions=newpal, zcol = "percent")
map
mapshot(map, file = "Spores.png")

m <- mapview()
```

#Weather grabber (Python)
```{python}
#Put this into terminal
#pip install meteostat
#pip install matplotlib
#pip install requests


# Import Meteostat library and dependencies
from datetime import datetime
import matplotlib.pyplot as plt
from meteostat import Point, Daily, Hourly, Stations
import pandas
import os
import requests
import numpy as np

#Read dataframe
os.chdir("C:/Users/codyp/Desktop/WorkBackup/Research/KrischikLab/SiteSampling")
volumeDataPy = pandas.read_csv('volumeData.csv', encoding = "ISO-8859-1")

#Break dates into separate columns
volumeDataPy[['DepMonth', 'DepDay', 'DepYear']] = volumeDataPy["Deployed"].str.split("/", expand=True)
volumeDataPy[['ColMonth', 'ColDay', 'ColYear']] = volumeDataPy["Collected"].str.split("/", expand=True)

#Break times into separate columns
volumeDataPy[['DepHr', 'DepMin']] = volumeDataPy["TimeDeployed"].str.split(":", expand=True)
volumeDataPy[['ColHr', 'ColMin']] = volumeDataPy["TimeCollected"].str.split(":", expand=True)

volumeDataPy[["DepMonth", "DepDay", "DepYear", "DepHr", "DepMin", "ColMonth", "ColDay", "ColYear", "ColHr", "ColMin"]] = volumeDataPy[["DepMonth", "DepDay", "DepYear", "DepHr", "DepMin", "ColMonth", "ColDay", "ColYear", "ColHr", "ColMin"]].apply(pandas.to_numeric)
volumeDataPy.loc[volumeDataPy['DepHr'] < 8, 'DepHr24'] = volumeDataPy['DepHr'] + 12
volumeDataPy.loc[volumeDataPy['DepHr'] > 8, 'DepHr24'] = volumeDataPy['DepHr']
volumeDataPy.loc[volumeDataPy['ColHr'] < 8, 'ColHr24'] = volumeDataPy['ColHr'] + 12
volumeDataPy.loc[volumeDataPy['ColHr'] > 8, 'ColHr24'] = volumeDataPy['ColHr']
#Loop through to get data for every time range

#One trap was deployed at 8 am
volumeDataPy["DepHr24"][93] = 8

i = 0
volumeDataPy["PreDepDay"] = volumeDataPy["DepDay"]
while i < 178:
   if volumeDataPy["DepDay"][i] == 1:
      volumeDataPy["PreDepDay"][i] = 31
   else:
      volumeDataPy["PreDepDay"][i] = volumeDataPy["DepDay"][i] - 1
   i = i + 1
   
i = 0
volumeDataPy["PreColDay"] = volumeDataPy["ColDay"]
while i < 178:
   if volumeDataPy["ColDay"][i] == 1:
      volumeDataPy["PreColDay"][i] = 31
   else:
      volumeDataPy["PreColDay"][i] = volumeDataPy["ColDay"][i] - 1
   i = i + 1
   
i = 0
volumeDataPy["PreDepMonth"] = volumeDataPy["DepMonth"]
while i < 178:
   if volumeDataPy["DepDay"][i] == 1:
      volumeDataPy["PreDepMonth"][i] = volumeDataPy["PreDepMonth"][i] - 1
      
   i = i + 1
   
i = 0
volumeDataPy["PreColMonth"] = volumeDataPy["ColMonth"]
while i < 178:
   if volumeDataPy["ColDay"][i] == 1:
      volumeDataPy["PreColMonth"][i] = volumeDataPy["PreColMonth"][i] - 1
      
   i = i + 1


i = 0
elevation = []
while i < 178:
   x = str(volumeDataPy["X"][i])
   y = str(volumeDataPy["Y"][i])
   z = x + "," + y
   url = "https://api.opentopodata.org/v1/srtm90m"
   data1 = {
      "locations" : z,
      "interpolation" : "cubic",
   }
   response = requests.post(url, data=data1)
   output = response.json()["results"]
   output = output[0]
   elevation.append(output['elevation'])
   print(i)
   i = i + 1
   
volumeDataPy["elevation"] = elevation

#Weather data during deployment
weather1 = {'Code':[],'Collected':[],'X':[],'Y':[],'avgTemp':[],'avgHum':[],'avgRain':[],'avgWsp':[],'avgWdir':[]}
weather1 = pandas.DataFrame(data=weather1)
i = 0
while i < 178:
   # Set time period
   start = datetime(int(volumeDataPy["DepYear"][i]), int(volumeDataPy["DepMonth"][i]), int(volumeDataPy["DepDay"][i]), int(volumeDataPy["DepHr24"][i]), int(volumeDataPy["DepMin"][i]))
   end = datetime(int(volumeDataPy["ColYear"][i]), int(volumeDataPy["ColMonth"][i]), int(volumeDataPy["ColDay"][i]), int(volumeDataPy["ColHr24"][i]), int(volumeDataPy["ColMin"][i]))
   # Create Point
   num = Point(volumeDataPy["X"][i], volumeDataPy["Y"][i], volumeDataPy["elevation"][i])

   # Get hourly data
   data = Hourly(num, start, end)
   data = data.fetch()
   avgTemp = sum(data["temp"])/(len(data["temp"]))
   avgHum = sum(data["rhum"])/(len(data["rhum"]))
   avgRain = sum(data["prb"])/(len(data["prb"]))
   avgWsp = sum(data["wspd"])/(len(data["wspd"]))
   avgWdir = sum(data["wdir"])/(len(data["wdir"]))
   add = {'Code': volumeDataPy["Code"][i], 'Collected': volumeDataPy["Collected"][i], 'X': volumeDataPy["X"][i], 'Y':volumeDataPy["Y"][i], 
'avgTemp':avgTemp, 'avgHum':avgHum, 'avgRain':avgRain, 'avgWsp':avgWsp, 'avgWdir':avgWdir}
   weather1 = weather1.append(add, ignore_index = True)
   i = i + 1
   
   
#Weather data for 24 hours before deployment
weather2 = {'Code':[],'Collected':[],'X':[],'Y':[],'avgTemp':[],'avgHum':[],'avgRain':[],'avgWsp':[],'avgWdir':[]}
weather2 = pandas.DataFrame(data=weather2)
add = {'Code': volumeDataPy["Code"][i], 'Collected': volumeDataPy["Collected"][i], 'X': volumeDataPy["X"][i], 'Y':volumeDataPy["Y"][i], 
'avgTemp':avgTemp, 'avgHum':avgHum, 'avgRain':avgRain, 'avgWsp':avgWsp, 'avgWdir':avgWdir}
i = 0
while i < 178:
   # Set time period
   start = datetime(int(volumeDataPy["DepYear"][i]), int(volumeDataPy["PreDepMonth"][i]), int(volumeDataPy["PreDepDay"][i]), int(volumeDataPy["DepHr24"][i]), int(volumeDataPy["DepMin"][i]))
   end = datetime(int(volumeDataPy["ColYear"][i]), int(volumeDataPy["PreColMonth"][i]), int(volumeDataPy["PreColDay"][i]), int(volumeDataPy["ColHr24"][i]), int(volumeDataPy["ColMin"][i]))
   # Create Point
   num = Point(volumeDataPy["X"][i], volumeDataPy["Y"][i], volumeDataPy["elevation"][i])

   # Get hourly data
   data = Hourly(num, start, end)
   data = data.fetch()
   avgTemp = sum(data["temp"])/(len(data["temp"]))
   avgHum = sum(data["rhum"])/(len(data["rhum"]))
   avgRain = sum(data["prb"])/(len(data["prb"]))
   avgWsp = sum(data["wspd"])/(len(data["wspd"]))
   avgWdir = sum(data["wdir"])/(len(data["wdir"]))
   weather2 = weather2.append(add, ignore_index = True)
   i = i + 1

weather1.to_csv('WeatherDuring.csv')
weather2.to_csv('WeatherBefore.csv')

# Plot line chart including average, minimum and maximum temperature
data.plot(y=['temp'])
plt.show()

#Measure distance from every site to weather station
 stations = Stations()
      stations = stations.nearby(volumeDataPy["X"][0], volumeDataPy["Y"][0])
      stations = stations.fetch(1)
      print(stations)

```

```{r}
WeatherBefore <- read.csv("WeatherBefore.csv")
names(WeatherBefore)[6:10] = c("preAvgTemp", "preAvgHum", "preAvgRain", "preAvgWsp", "preAvgWdir")
WeatherDuring <- read.csv("WeatherDuring.csv")
volumeDataWe <- merge(volumeData, WeatherDuring, by = c("Code", "Collected"))
volumeDataFin <- merge(volumeDataWe, WeatherBefore, by = c("Code", "Collected", "X", "Y"))

volumeDataWe["avgTempSc"] <- scale(volumeDataWe["avgTemp"])
volumeDataWe["avgHumSc"] <- scale(volumeDataWe["avgHum"])
volumeDataWe["avgRainSc"] <- scale(volumeDataWe["avgRain"])
volumeDataWe["avgWspSc"] <- scale(volumeDataWe["avgWsp"])
volumeDataWe["avgWdirSc"] <- scale(volumeDataWe["avgWdir"])
```

##Remote Sensing
```{python}
#We are going to import a shapefile for Twin Cities land use. 
#Land use classes include golf courses as their own classification,
#along with Parks, recreational, and preserves as another.
#All of our sites should fit into these two categories.
#The one on campus would likely be the exception.

#The following goes into the terminal
#pip install geopandas

import pandas as pd
import shapefile as shp
import geopandas as gpd
import matplotlib.pyplot as plt
from shapely.geometry import Point

#fullshape here, takes a long time to load
#shp_file = gpd.read_file('GeneralizedLandUse2020.shp')
#shp_file.to_file('myshpfile.geojson', driver='GeoJSON')

polygons = gpd.read_file('GolfCourse.geojson')

polygons.geometry.is_valid

clean = polygons.geometry.buffer(0)

clean.geometry.is_valid

clean.plot()



volumeDataPy = pd.read_csv('volumeData.csv', encoding = "ISO-8859-1")

volumeDataPy['geometry'] = volumeDataPy.apply(lambda x: Point((x.Y, x.X)),
axis = 1)
volumeDataPy.head(3)

volumeDataPy_crs = {'init': 'epsg:4326'}
volumeDataPy_geo = gpd.GeoDataFrame(volumeDataPy,
crs =volumeDataPy_crs,
geometry = volumeDataPy.geometry)

volumeDataPy_geo.head(27)

volumeDataPy_geo.geometry = volumeDataPy_geo.geometry.to_crs(epsg = 3857)
volumeDataPy_geo.head(27)

volumeDataPy_geo.geometry()

```

#Map making
```{r}
library(tidyr)
SiteData <- separate(SiteData, col=Coordinates, into=c('X', 'Y'), sep=',')
detach(package:tidyr)
SiteData$X <- as.numeric(SiteData$X)
SiteData$Y <- as.numeric(SiteData$Y)

xy <- volumeData[,c("Y","X")]

spdf <- SpatialPointsDataFrame(coords = c(as.numeric(volumeData$Y), as.numeric(volumeData$X)), data = volumeData, proj4string = CRS("+proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0"))


m <- mapview(map)
addFeatures(m, points_sf)


```

#Create shapefile for remote sensing
```{r}
map_sf <- read_sf("GeneralizedLandUse2020.shp")
#This shapefile is massive and R is slow, I need to split into separate shapefiles for manipulation
golf <- subset(map_sf, DESC2020 == "Golf Course")
park <- subset(map_sf, DESC2020 == "Park, Recreational, or Preserve")
inst <- subset(map_sf, DESC2020 == "Institutional")
ag <- subset(map_sf, DESC2020 == "Agricultural")
samplingData <- read.csv("Sampling.csv")
SporeCounts <- read.csv("SporeCounts.csv")
Key <- read.csv("Key.csv")
names(Key)[2] <- "Code"

#Only interested in quantity of beetles, subset for type v
volumeData <- subset(samplingData, Type == "v")

#loops a sequence in the column volume, using volume since we are doing math on it.
for(x in seq_along(volumeData[,14]))
  {
  #if NA value is present for beetle...
    if(is.na(volumeData[x,15]))
    {
      #The value of beetles equals the value for volume entered into our equation, 
      #generated by a line of best fit through our scatterplot
    volumeData[x,15] <- (3.07*as.numeric(volumeData[x,14]))-39.6
    }
  #else argument may or may not be necessary, 
  #but for every iteration where we have a value for beetles, we want to keep our value
    else
    {
      volumeData[x,15] <- volumeData[x,15]
    }
      
}

names(volumeData)[2] <- "Code"
Site <- aggregate(Beetles ~ Code, data = volumeData, FUN = sum)
SiteData <- merge(Site, Key, by="Code")


#We recorded coordinates in one column, silly
library(tidyr)
SiteData <- separate(SiteData, col=Coordinates, into=c('X', 'Y'), sep=',')
detach(package:tidyr)

#Now make the strings numeric
SiteData$X <- as.numeric(SiteData$X)
SiteData$Y <- as.numeric(SiteData$Y)

#One site was out of the polygon boundary
SiteData[23,]$X <- 45.071783
SiteData[23,]$Y <- -92.873215

#Giving SpatialPointsDataFrame a unified xy (numerical)
xy <- SiteData[,c("Y","X")]

spdf_points <- SpatialPointsDataFrame(coords = xy, data = SiteData, proj4string = CRS("+proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0"))

#I don't think this transformation was necessary, however st_join threw an error without it.
spdf_NAD <- spTransform(spdf_points, CRS("+init=epsg:4326"))
spdf_NAD <- st_as_sf(spdf_NAD)

#For each designation, we need to transform to be the same as the points,
golf <- st_transform(golf, CRS("+init=epsg:4326"))

#Make the polygons valid (had some overlapping issues)
golf <- st_make_valid(golf)
#Verify fixed
st_is_valid(golf)

#Cast out multipolygon class to a polygon class. 
#This is super important because multipolygon is only one row of data. 
#We need to get rid of polygons that our points do not fall within.
golf_poly <- st_cast(golf, "POLYGON")

#Finally, we do the join, which combines the xy point with the polygon.
#Data are shared, and the left=FALSE qualifyer gets rid of all of the polygons we do not want.
Map_point_golf <- st_join(golf_poly, spdf_NAD, left=FALSE)

#Now, we do the same steps for each of our classifications.
#Yes, this would be easier to do with the whole shapefile. 
#I think my laptop would take 20 years to process it.
park <- st_transform(park, CRS("+init=epsg:4326"))

park <- st_make_valid(park)
st_is_valid(park)

park_poly <- st_cast(park, "POLYGON")

Map_point_park <- st_join(park_poly, spdf_NAD, left=FALSE)
#LG, LP, PG, SG, TS need to be edited somehow.KP and LO are good. 7 


ag <- st_transform(ag, CRS("+init=epsg:4326"))

ag <- st_make_valid(ag)
st_is_valid(ag)

ag_poly <- st_cast(ag, "POLYGON")

Map_point_ag <- st_join(ag_poly, spdf_NAD, left=FALSE)
#St. Croix Vineyards is only ag. 

inst <- st_transform(inst, CRS("+init=epsg:4326"))

inst <- st_make_valid(inst)
st_is_valid(inst)

inst_poly <- st_cast(inst, "POLYGON")

Map_point_inst <- st_join(inst_poly, spdf_NAD, left=FALSE)
#cemeteries and university.

#Finally, we recombine all of our polygons into one dataframe.
#This is our shapefile for the remote sensing portion.
Map_point <- rbind(Map_point_ag, Map_point_golf, Map_point_inst)

#we can compare our shapes to the xy values
M <- mapview(Map_point)
addFeatures(M, spdf_NAD)

st_write(Map_point, "Sensing.geojson", driver = "GeoJSON")
#Shapes only, 1 per site

Sensing <- merge(volumeData, Map_point[7:8], by = "Code")
#Each location has multiple lines of information based on number of samples.

st_write(Sensing, "Sensing1.geojson", driver = "GeoJSON")
head(Map_point_park)
```

##Remote sensing
```{python}


```

##NDVI Stats
```{r}
remote <- geojson_read("ZonalStatsNDVI_Polygons1.geojson", what="sp")
RemoteData <- as.data.frame(remote)
RemoteData$SE <- RemoteData$std / (sqrt(RemoteData$count))
NDVI <- merge(volumeData, RemoteData[8:13], by = "Code")
NDVIMax <- merge(SiteDatax, RemoteData[8:13], by = "Code")
NDVI$SE <- NDVI$std / (sqrt(NDVI$count))

LR1 <- glm(Beetles ~ min, family = negative.binomial(theta = 1, link = "log"), data = NDVIMax)
Anova(LR1, type = 2)

sim_bmond <- simulateResiduals(fittedModel = LR1, n = 250)
hist(sim_bmond)
plot(sim_bmond)

#NDVI does not predict JB trap catch.


NDVIMap <- aggregate(mean ~ Code, data=NDVI, FUN=mean)
NDVIMap1 <- merge(NDVIMap, Map_point)
NDVIMap1 <- st_as_sf(NDVIMap1)
newpal1 <- c("#d73027", "#fdae61", "#ffffbf", "#a6d96a", "#1a9850")
mapview(NDVIMap1, col.regions=newpal1, zcol = "mean")
```

#Testing for temporal autocorrelation
```{r}
model <- lm(Beetles ~ Collected, data = volumeData)
acf(model$residuals, type="correlation")
#Lack of evidence for temporal autocorrelation



type <- glmmTMB(Beetles ~ SiteType + (1|Collected) + (1|Code), data = volumeData, family="nbinom2")
summary(type)
plot(simulateResiduals(type)) 
hist(simulateResiduals(type)) 

```

#Testing for spatial autocorrelation
```{r}
fittedModel <- lm(Beetles ~ preAvgTemp, data = volumeDataFin)
res = simulateResiduals(fittedModel)
groupLocations = aggregate(volumeDataFin[, 3:4], list(volumeDataFin$Code), mean)
res2 = recalculateResiduals(res, group = volumeDataFin$Code)
testSpatialAutocorrelation(res2, groupLocations$X, groupLocations$Y)
##No evidence for spatial autocorrelation
```

#AIC Selection
```{r}
library(lubridate)

volumeDataWeNDVI <- merge(NDVI,volumeDataWe, by = c("Code", "Collected"))
volumeDataWeSoil <- merge(volumeDataWe, SoilTexture, by = c("Code", "Collected"))
volumeDataWe$BeetlesCount <- round(volumeDataWe$Beetles, 0)
volumeDataWe$Beetles.L <- log(volumeDataWe$Beetles)

b1 <- glmmTMB(BeetlesCount ~ SampleDay + I(SampleDay**2) + avgTempSc + avgHumSc + avgRainSc + avgWspSc + (1|Code), data = volumeDataWe, family="nbinom2")
summary(b1)


model.sel(b1,b2,b2a,b2b,b2c,b2d,b2e,b2f,b2g,b2h, b3, b4, b5, b6, b7, b8, b9, b10, b11, b12, b13, b14, b15, b16, b17, b18, b19, b20, b21, b22, b23, b24, b25, b26, b27, b28, b29, b30, b31, b32, b33, b34, b35, b36, b37)

plot(volumeDataFin$preAvgTemp, volumeDataFin$Beetles)
summary(b2a)

plot(simulateResiduals(b1)) 
hist(simulateResiduals(b1))

png("BeetlesTime.png", width=6, height=6, units="in", res=400)
ggplot(volumeDataWe, aes(x=SampleDay, y=BeetlesCount))+geom_jitter(height=0.1, alpha=0.12, size=1.75)+
  geom_smooth(color="black", method="glm", method.args=list(family="nbinom2"), formula = y ~ x+I(x^2)+I(x^3)) + theme_bw() + 
  theme(strip.background = element_blank(), panel.grid.minor= element_blank(), panel.grid.major= element_blank(),
        text = element_text(size=16))+
  labs(x="Sample Day", y="Number of beetles")
dev.off()
```

#AIC Spores
```{r}
volumeDataSporesWe <- merge(volumeDataSpores, volumeDataWe, by = c("Code", "Collected"))

b1 <- glmmTMB(Infected ~ SampleDay.x + I(SampleDay.x**2) + avgTempSc + avgHumSc + avgRainSc + avgWspSc + ar1(0 + as.factor(SampleDay.x)|Code), data = volumeDataSporesWe, family="binomial")
summary(b1)

png("SporessTime.png", width=6, height=6, units="in", res=400)
ggplot(volumeDataSporesWe, aes(x=SampleDay.x, y=Infected))+geom_jitter(height=0.1, alpha=0.12, size=1.75)+
  geom_smooth(color="black", method="glm", method.args=list(family="nbinom2"), formula = y ~ x+I(x^2)) + theme_bw() + 
  theme(strip.background = element_blank(), panel.grid.minor= element_blank(), panel.grid.major= element_blank(),
        text = element_text(size=16))+
  labs(x="Sample Day", y="Propotion of sites infected")
dev.off()

volumeDataSporesWeInf <- subset(volumeDataSporesWe, Infected==1)
volumeDataSporesWeInf$AvgSpores.L <- log(volumeDataSporesWeInf$AvgSpores)
b1 <- glmmTMB(AvgSpores.L ~ SampleDay.x + I(SampleDay.x**2) + avgTempSc + avgHumSc + avgRainSc + avgWspSc + ar1(0 + as.factor(SampleDay.x)|Code), data = volumeDataSporesWeInf, family="gaussian")
summary(b1)

png("SporessTimeInf.png", width=6, height=6, units="in", res=400)
ggplot(volumeDataSporesWeInf, aes(x=SampleDay.x, y=AvgSpores.L))+geom_jitter(height=0.1, alpha=0.12, size=1.75)+
  geom_smooth(color="black", method="glm", method.args=list(family="nbinom2"), formula = y ~ x+I(x^2)) + theme_bw() + 
  theme(strip.background = element_blank(), panel.grid.minor= element_blank(), panel.grid.major= element_blank(),
        text = element_text(size=16))+
  labs(x="Sample Day", y="log(Number of spores)")
dev.off()
```

#Weather plots
```{r}
p16 <- glmmTMB(BeetlesCount ~ SampleDay + I(SampleDay**2) + (1|Code), data=volumeDataWe, family="nbinom2") ##no weather variables

volumeDataWe$resid <-residuals(p16)
library(viridis)

png("TemperatureBeetles.png", width=6, height=6, units="in", res=400)
ggplot(volumeDataWe, aes(x=avgTemp, y=resid))+
  theme_bw() + geom_jitter(volumeDataWe, mapping=aes(x=avgTemp, y=resid), height=0.1, alpha=0.1, size=1.75)+
  geom_smooth(color="black", method="glm", size=2)+ 
  theme(strip.background = element_blank(), panel.grid.minor= element_blank(), panel.grid.major= element_blank(),
        text = element_text(size=16), legend.position="none")+
  labs(x=expression(paste('Average Daily Temperature (',~degree,'C)',sep='')), y="Model Residuals")+
  scale_color_viridis(discrete = T, direction = -1, begin= .85, end=.85, alpha=0.08)+
  scale_x_continuous(breaks = scales::pretty_breaks(n = 10)) 
dev.off()

png("RainfallBeetles.png", width=6, height=6, units="in", res=400)
ggplot(volumeDataWe, aes(x=avgRain, y=resid))+
  theme_bw() + geom_jitter(volumeDataWe, mapping=aes(x=avgRain, y=resid), height=0.1, alpha=0.1, size=1.75)+
  geom_smooth(color="black", method="glm", size=2)+ 
  theme(strip.background = element_blank(), panel.grid.minor= element_blank(), panel.grid.major= element_blank(),
        text = element_text(size=16), legend.position="none")+
  labs(x="Average Daily Rainfall (cm)", y="Model Residuals")+
  scale_color_viridis(discrete = T, direction = -1, begin= .55, end=.55, alpha=0.08)+
  scale_x_continuous(breaks = scales::pretty_breaks(n = 5)) 
dev.off()

png("WindSpeedBeetles.png", width=6, height=6, units="in", res=400)
ggplot(volumeDataWe, aes(x=avgWsp, y=resid))+
  theme_bw() + geom_jitter(volumeDataWe, mapping=aes(x=avgWsp, y=resid), height=0.1, alpha=0.1, size=1.75)+
  geom_smooth(color="black", method="glm", size=2)+ 
  theme(strip.background = element_blank(), panel.grid.minor= element_blank(), panel.grid.major= element_blank(),
        text = element_text(size=16), legend.position="none")+
  labs(x="Average Daily Wind Speed", y="Model Residuals")+ ##use expression for superscript
  scale_color_viridis(discrete = T, direction = -1, begin= .25, end=.25, alpha=0.08)+
  scale_x_continuous(breaks = scales::pretty_breaks(n = 10)) 
dev.off()

png("HumidityBeetles.png", width=6, height=6, units="in", res=400)
ggplot(volumeDataWe, aes(x=avgHum, y=resid))+
  theme_bw() + geom_jitter(volumeDataWe, mapping=aes(x=avgHum, y=resid), height=0.1, alpha=0.1, size=1.75)+
  geom_smooth(color="black", method="glm", size=2)+ 
  theme(strip.background = element_blank(), panel.grid.minor= element_blank(), panel.grid.major= element_blank(),
        text = element_text(size=16), legend.position="none")+
  labs(x="Average Daily Humidity (%)", y="Model Residuals")+
  scale_color_viridis(discrete = T, direction = -1, begin= 0, end=0, alpha=0.08)+
  scale_x_continuous(breaks = scales::pretty_breaks(n = 10))
dev.off()
```

